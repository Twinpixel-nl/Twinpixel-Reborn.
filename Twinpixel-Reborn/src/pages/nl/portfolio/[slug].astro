---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import { getCollection, type CollectionEntry } from "astro:content";

export const prerender = true;

export async function getStaticPaths() {
  const entries = await getCollection('cases', ({ data }) => data.lang === 'nl');
  return entries.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

interface Props {
  entry: CollectionEntry<'cases'>;
}
const { entry } = Astro.props as Props;
const { Content } = await entry.render();

const site = Astro.site?.toString().replace(/\/$/, "") ?? "";
const url = `${site}/nl/portfolio/${entry.slug}/`;

const jsonLd = [
  {
    "@context": "https://schema.org",
    "@type": "CreativeWork",
    "name": entry.data.title,
    "description": entry.data.description || "",
    "datePublished": new Date(entry.data.date).toISOString(),
    "inLanguage": "nl-NL",
    "mainEntityOfPage": url,
    "url": url,
    ...(entry.data.cover ? { "image": entry.data.cover } : {})
  },
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      { "@type": "ListItem", "position": 1, "name": "Home", "item": `${site}/nl/` },
      { "@type": "ListItem", "position": 2, "name": "Portfolio", "item": `${site}/nl/portfolio/` },
      { "@type": "ListItem", "position": 3, "name": entry.data.title, "item": url }
    ]
  }
];
---

<BaseLayout
  title={`${entry.data.title} | TwinPixel`}
  description={entry.data.description}
  lang="nl"
  canonical={`/nl/portfolio/${entry.slug}/`}
  alternates={{ nl: url }}
  jsonLd={jsonLd}
>
  <article class="section">
    <header class="mb-6">
      <h1 class="text-3xl md:text-4xl font-semibold">{entry.data.title}</h1>
      <p class="text-slate-500 mt-2">
        {new Date(entry.data.date).toLocaleDateString("nl-NL")}
      </p>
      {entry.data.sector && <p class="text-slate-400 mt-1">{entry.data.sector}</p>}
    </header>

    {entry.data.cover && (
      <figure class="mb-6">
        <img
          src={entry.data.cover}
          alt={`Coverbeeld: ${entry.data.title}`}
          width="1200"
          height="675"
          loading="eager"
          decoding="async"
          fetchpriority="high"
          style="width:100%;height:auto"
        />
      </figure>
    )}

    <div class="prose text-slate-200">
      <h2>Probleem</h2>
      {/* Verwacht dat de markdown secties de structuur "Probleem → Aanpak → Resultaat" volgen */}
      <Content />
    </div>

    {entry.data.gallery?.length > 0 && (
      <section class="mt-10">
        <h2 class="text-2xl font-semibold mb-4">Galerij</h2>
        <div class="grid gap-4 sm:grid-cols-2">
          {entry.data.gallery.map((src: string) => (
            <img
              src={src}
              alt={`Galerijbeeld: ${entry.data.title}`}
              width="1200"
              height="675"
              loading="lazy"
              decoding="async"
              style="width:100%;height:auto"
            />
          ))}
        </div>
      </section>
    )}

    <footer class="mt-10">
      <a href="/nl/contact/" class="btn-primary">Neem contact op</a>
    </footer>
  </article>
</BaseLayout>
